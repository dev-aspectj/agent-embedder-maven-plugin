<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src\site\markdown/usage.md.vm
 | Rendered using Apache Maven Fluido Skin 1.11.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>Agent Embedder Maven Plugin &#x2013; Usage</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.11.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-1.11.1.min.js"></script>
    <style>.github-fork-ribbon:before { background-color: gray; }</style>
  </head>
  <body class="topBarDisabled">
    <a class="github-fork-ribbon right-top" href="https://github.com/dev-aspectj/agent-embedder-maven-plugin" data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a>
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h1>Agent Embedder Maven Plugin</h1>
</div>
</div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
      <li class=""><a href="./index.html" title="Agent Embedder Maven Plugin">Agent Embedder Maven Plugin</a><span class="divider">/</span></li>
    <li class="active ">Usage <a href="https://github.com/dev-aspectj/agent-embedder-maven-plugin/src\site\markdown/usage.md.vm"><img src="./images/accessories-text-editor.png" title="Edit" /></a></li>
      <li id="projectVersion" class="pull-right">Version: 1.0</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="./index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="./usage.html" title="Usage"><span class="none"></span>Usage</a></li>
    <li><a href="./plugin-info.html" title="Goals"><span class="none"></span>Goals</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<h1>Usage</h1>
<p>Assuming that your Maven module creates an executable JAR and you want to embed java agent <code>org.acme:my-agent:1.3</code> for
automatic execution on Java 9+, simply configure this plugin as follows:</p>

<div class="source"><pre class="prettyprint"><code class="language-xml">&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;dev.aspectj&lt;/groupId&gt;
      &lt;artifactId&gt;agent-embedder-maven-plugin&lt;/artifactId&gt;
      &lt;version&gt;1.0&lt;/version&gt;
      &lt;executions&gt;
        &lt;execution&gt;
          &lt;id&gt;embed-agent&lt;/id&gt;
          &lt;goals&gt;
            &lt;goal&gt;embed&lt;/goal&gt;
          &lt;/goals&gt;
          &lt;configuration&gt;
            &lt;javaAgents&gt;
              &lt;agent&gt;
                &lt;groupId&gt;org.acme&lt;/groupId&gt;
                &lt;artifactId&gt;my-agent&lt;/artifactId&gt;
              &lt;/agent&gt;
            &lt;/javaAgents&gt;
          &lt;/configuration&gt;
        &lt;/execution&gt;
      &lt;/executions&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;

&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.acme&lt;/groupId&gt;
    &lt;artifactId&gt;my-agent&lt;/artifactId&gt;
    &lt;version&gt;1.3&lt;/version&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre></div>
<p>This will replace the Maven module's main artifact - the plain executable JAR - by an enhanced executable JAR in which
the java agent has been embedded and added to the manifest to be launched automatically whenever the JAR is started by
<code>java &#x2011;jar my-executable.jar</code>.</p>
<p>This works just like the example above, but you simply add multiple java agent dependencies and reference them from the
plugin configuration as multiple <code>javaAgents/agent</code> descriptors. When starting the executable JAR, the agents will be
launched in the order specified in the plugin configuration.</p>
<p>See the <a href="embed-mojo.html"><code>agent-embedder:embed</code></a> goal description for more details.</p>
<p>You might have special use cases, such as:</p>
<table border="0" class="table table-striped">
<thead>

<tr class="a">
<th>Use case</th>
<th>Configuration parameter</th></tr>
</thead><tbody>

<tr class="b">
<td align="left">The java agent exists as a nested JAR inside the build artifact, as is often the case in Spring Boot executable JARs. You want to make sure that after embedding the agent classes into the main JAR, the nested JAR is removed from the  main (uber) JAR.</td>
<td><code>removeEmbeddedAgents</code></td></tr>
<tr class="a">
<td align="left">The java agent's Maven coordinates include a <code>classifier</code>.</td>
<td><code>javaAgents/agent/classifier</code></td></tr>
<tr class="b">
<td align="left">The java agent is configurable by means of an options string on the JVM command line via <code>&#x2011;javaagent:/path/to/agent.jar=option1=one,option2=two</code>. You wish to emulate that for the embedded agent.</td>
<td><code>javaAgents/agent/agentArgs</code></td></tr>
<tr class="a">
<td align="left">The agent JAR is not a regular dependency to be found in any Maven repository but rather a library somewhere in your project folder, and you want to specify the path to the agent JAR in the plugin configuration.</td>
<td><code>javaAgents/agent/agentPath</code></td></tr>
<tr class="b">
<td align="left">The agent JAR is not a regular dependency to be found in any Maven repository but rather a nested JAR with a known location inside the main JAR, and you want to specify the path to the agent JAR in the plugin configuration.</td>
<td><code>javaAgents/agent/agentPath</code></td></tr>
<tr class="a">
<td align="left">The agent JAR is missing a manifest with an <code>Agent-Class</code> entry, even though it does contain a class with a <code>premain</code> entry point usable for a java agent, and you want to specify the agent class name.</td>
<td><code>javaAgents/agent/agentClass</code></td></tr>
<tr class="b">
<td align="left">The agent JAR's <code>Agent-Class</code> manifest entry points to an agent class A, but you want to use an alternative agent class B.</td>
<td><code>javaAgents/agent/agentClass</code></td></tr>
</tbody>
</table>
<p>See the <a href="embed-mojo.html"><code>agent-embedder:embed</code></a> goal description for more details.</p>
<p>See the <a class="externalLink" href="https://github.com/dev-aspectj/agent-embedder-maven-plugin/tree/main/src/it/SpringBootAspectJ">Spring Boot integration test</a>,
which embeds two java agents (AspectJ weaver and a home-brew agent making final classes non-final) into an executable
Spring Boot JAR and then runs the modified JAR to verify that indeed both agents are launched automatically and do their
respective jobs.</p>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">

        </div>
      </div>
    </footer>
<script>
	if(anchors) {
	  anchors.add();
	}
</script>
  </body>
</html>
